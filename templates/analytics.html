{% extends "base.html" %}

{% block title %}Analytics Dashboard{% endblock %}

{% block content %}
{% if current_user.is_authenticated %}
<div class="analytics-container">
    <h1>Analytics Dashboard</h1>
    
    <div class="overview">
        <h2>Overview</h2>
        <p>Total Courses: {{ total_courses }}</p>
        <p>Total Assignments: {{ total_assignments }}</p>
        <p>Overall Completion Rate: {{ "%.2f"|format(overall_completion_rate) }}%</p>
        <p>Average Grade: {{ "%.2f"|format(average_grade) }}</p>
    </div>

    <div class="charts">
        <h2>Charts</h2>
        <div class="chart-container">
            <canvas id="submissionTimelineChart"></canvas>
        </div>
        <div class="chart-container">
            <canvas id="courseCompletionChart"></canvas>
        </div>
        <div class="chart-container">
            <canvas id="gradeDistributionChart"></canvas>
        </div>
        <div class="chart-container">
            <canvas id="workloadDistributionChart"></canvas>
        </div>
    </div>

    <div class="course-analytics">
        <h2>Course Analytics</h2>
        <table id="courseAnalyticsTable" class="display">
            <thead>
                <tr>
                    <th>Course Name</th>
                    <th>Total Assignments</th>
                    <th>Submitted Assignments</th>
                    <th>Completion Rate</th>
                    <th>Average Grade</th>
                </tr>
            </thead>
            <tbody>
                {% for course in analytics_data %}
                <tr>
                    <td>{{ course.course_name }}</td>
                    <td>{{ course.total_assignments }}</td>
                    <td>{{ course.submitted_assignments }}</td>
                    <td>{{ "%.2f"|format(course.completion_rate) }}%</td>
                    <td>{{ "%.2f"|format(course.average_grade) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% else %}
    <div class="alert alert-warning">
        Please <a href="{{ url_for('authorize') }}">log in</a> to view analytics.
    </div>
{% endif %}
{% endblock %}

{% block scripts %}
{% if current_user.is_authenticated %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
<script>
    var chartData = JSON.parse('{{ chart_data|safe }}');
</script>
<script src="{{ url_for('static', filename='js/analytics.js') }}"></script>
{% endif %}
{% endblock %}